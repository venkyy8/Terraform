/**

This Terraform script sets up the following:

Creates one VPC with the CIDR block "10.0.0.0/16".
Sets up two public subnets and two private subnets in two different availability zones (AZ1 and AZ2).
Creates a public route table and associates both public subnets with it.
Creates an internet gateway and associates it with the public route table.
Sets up two private route tables (one for each private subnet) and associates each private subnet with its respective private route table.
Creates two NAT gateways (one for each availability zone) and associates them with their corresponding private route tables.
Allocates Elastic IP addresses for the NAT gateways.

**/

provider "aws" {
  access_key = "AKIARHHOA234PBA3PSMJ"
  secret_key = "Kv/qoiYsbrIyTBISL6rBKptYNZERBcliwMmH46e2"
  region     = "ap-northeast-1"

}
resource "aws_vpc" "my_vpc" {
  cidr_block = "10.0.0.0/16"  # Change this to your desired VPC CIDR block

  tags = {
    Name = "MyVPC"   # Change this to your desired VPC name
  }
}

resource "aws_subnet" "public_subnet_az1" {
  vpc_id     = aws_vpc.my_vpc.id
  cidr_block = "10.0.1.0/24"   # Change this to your desired public subnet CIDR block for AZ1
  availability_zone = "ap-northeast-1a"  # Change this to your desired AZ code for AZ1

  tags = {
    Name = "PublicSubnet-AZ1"   # Change this to your desired subnet name
  }
}

resource "aws_subnet" "private_subnet_az1" {
  vpc_id     = aws_vpc.my_vpc.id
  cidr_block = "10.0.2.0/24"   # Change this to your desired private subnet CIDR block for AZ1
  availability_zone = "ap-northeast-1a"  # Change this to your desired AZ code for AZ1

  tags = {
    Name = "PrivateSubnet-AZ1"   # Change this to your desired subnet name
  }
}

resource "aws_subnet" "public_subnet_az2" {
  vpc_id     = aws_vpc.my_vpc.id
  cidr_block = "10.0.3.0/24"   # Change this to your desired public subnet CIDR block for AZ2
  availability_zone = "ap-northeast-1c"  # Change this to your desired AZ code for AZ2

  tags = {
    Name = "PublicSubnet-AZ2"   # Change this to your desired subnet name
  }
}

resource "aws_subnet" "private_subnet_az2" {
  vpc_id     = aws_vpc.my_vpc.id
  cidr_block = "10.0.4.0/24"   # Change this to your desired private subnet CIDR block for AZ2
  availability_zone = "ap-northeast-1c"  # Change this to your desired AZ code for AZ2

  tags = {
    Name = "PrivateSubnet-AZ2"   # Change this to your desired subnet name
  }
}

resource "aws_route_table" "public_route_table" {
  vpc_id = aws_vpc.my_vpc.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.my_igw.id
  }

  tags = {
    Name = "PublicRouteTable"   # Change this to your desired route table name
  }
}

resource "aws_route_table_association" "public_subnet_az1_association" {
  subnet_id      = aws_subnet.public_subnet_az1.id
  route_table_id = aws_route_table.public_route_table.id
}

resource "aws_route_table_association" "public_subnet_az2_association" {
  subnet_id      = aws_subnet.public_subnet_az2.id
  route_table_id = aws_route_table.public_route_table.id
}

resource "aws_internet_gateway" "my_igw" {
  vpc_id = aws_vpc.my_vpc.id

  tags = {
    Name = "MyInternetGateway"   # Change this to your desired internet gateway name
  }
}

resource "aws_route_table" "private_route_table_az1" {
  vpc_id = aws_vpc.my_vpc.id

  tags = {
    Name = "PrivateRouteTable-AZ1"   # Change this to your desired route table name for AZ1
  }
}

resource "aws_route_table" "private_route_table_az2" {
  vpc_id = aws_vpc.my_vpc.id

  tags = {
    Name = "PrivateRouteTable-AZ2"   # Change this to your desired route table name for AZ2
  }
}

resource "aws_route" "private_subnet_az1_route" {
  route_table_id         = aws_route_table.private_route_table_az1.id
  destination_cidr_block = "0.0.0.0/0"
  nat_gateway_id         = aws_nat_gateway.nat_gateway_az1.id
}

resource "aws_route" "private_subnet_az2_route" {
  route_table_id         = aws_route_table.private_route_table_az2.id
  destination_cidr_block = "0.0.0.0/0"
  nat_gateway_id         = aws_nat_gateway.nat_gateway_az2.id
}

resource "aws_nat_gateway" "nat_gateway_az1" {
  allocation_id = aws_eip.nat_gateway_eip_az1.id
  subnet_id     = aws_subnet.public_subnet_az1.id

  tags = {
    Name = "NATGateway-AZ1"   # Change this to your desired NAT gateway name for AZ1
  }
}

resource "aws_nat_gateway" "nat_gateway_az2" {
  allocation_id = aws_eip.nat_gateway_eip_az2.id
  subnet_id     = aws_subnet.public_subnet_az2.id

  tags = {
    Name = "NATGateway-AZ2"   # Change this to your desired NAT gateway name for AZ2
  }
}

resource "aws_eip" "nat_gateway_eip_az1" {
  domain = "vpc"   # Use the 'domain' attribute instead of 'vpc'

  tags = {
    Name = "NATGatewayEIP-AZ1"   # Change this to your desired EIP name for AZ1
  }
}

resource "aws_eip" "nat_gateway_eip_az2" {
  domain = "vpc"   # Use the 'domain' attribute instead of 'vpc'

  tags = {
    Name = "NATGatewayEIP-AZ2"   # Change this to your desired EIP name for AZ2
  }
}
